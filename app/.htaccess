# CHM-SISTEMA - .htaccess App (Produção)
# @author ch-mestriner (https://ch-mestriner.com.br)
# @date 29/12/2025 16:15
# @version 2.4.0
#
# Compatível com hospedagem compartilhada
# NÃO usar php_value/php_flag aqui

Options -Indexes

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Arquivos estáticos servidos diretamente
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|json|webmanifest)$ [NC]
    RewriteRule ^ - [L]
    
    # Todas as outras requisições vão para index.php
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php [QSA,L]
</IfModule>

# Protege arquivos sensíveis
<FilesMatch "\.(sql|bak|old|log|ini|env|sh|php~)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order Allow,Deny
        Deny from all
    </IfModule>
</FilesMatch>

# Protege diretórios de config
<IfModule mod_rewrite.c>
    RewriteRule ^config/ - [F,L]
    RewriteRule ^core/ - [F,L]
    RewriteRule ^database/ - [F,L]
</IfModule>

# Charset UTF-8
AddDefaultCharset UTF-8

# Compressão GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Headers de Segurança
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>
